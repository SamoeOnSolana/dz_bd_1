@page
@model App1.Pages.Events1.IndexModel
@{
    ViewData["Title"] = "Події";
}

<div class="container mx-auto p-6">
    <h1 class="text-3xl font-bold text-gray-800 mb-6">Події</h1>

    <form method="get" class="mb-6 bg-white p-4 rounded-lg shadow">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div>
                <input type="text" name="SearchQuery" value="@Model.SearchQuery" placeholder="Пошук за назвою або місцем" class="w-full px-3 py-2 border border-gray-300 rounded-md" />
            </div>
            <div>
                <select name="SortBy" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                    <option value="">Сортування</option>
                    <option value="participants" selected="@(Model.SortBy == "participants")">За кількістю учасників (більше)</option>
                    <option value="participantsdesc" selected="@(Model.SortBy == "participantsdesc")">За кількістю учасників (менше)</option>
                </select>
            </div>
            <div>
                <button type="submit" class="w-full bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">Пошук</button>
            </div>
        </div>
    </form>

    <div class="bg-white rounded-lg shadow overflow-hidden">
        <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ID</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Назва</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Дата</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Місце</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Учасники</th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                @foreach (var evt in Model.Events)
                {
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">@evt.Id</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">@evt.Title</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">@evt.Date.ToString("dd.MM.yyyy")</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">@evt.Location</td>
                        <td class="px-6 py-4 text-sm text-gray-900">
                            @evt.EventParticipants.Count() учасників
                            @foreach (var ep in evt.EventParticipants)
                            {
                                <div class="text-xs text-gray-600">@ep.Participant.FullName</div>
                            }
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <div class="mt-4 flex justify-between items-center">
        <div>
            Сторінка @Model.PageNumber з @Model.TotalPages (всього: @Model.TotalCount)
        </div>
        <div class="flex gap-2">
            @if (Model.PageNumber > 1)
            {
                <a href="?PageNumber=@(Model.PageNumber - 1)&SearchQuery=@Model.SearchQuery&SortBy=@Model.SortBy" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">Назад</a>
            }
            @if (Model.PageNumber < Model.TotalPages)
            {
                <a href="?PageNumber=@(Model.PageNumber + 1)&SearchQuery=@Model.SearchQuery&SortBy=@Model.SortBy" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">Вперед</a>
            }
        </div>
    </div>
</div>
